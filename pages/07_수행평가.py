import streamlit as st
import pandas as pd
import plotly.express as px

# ----------------------------------------------------
# í˜ì´ì§€ ì„¤ì •
# ----------------------------------------------------
st.set_page_config(
    page_title="ì„œìš¸ì‹œ ìì¹˜êµ¬ë³„ ì¼ë°˜ìŒì‹ì  í˜„í™©",
    layout="wide",
    initial_sidebar_state="collapsed",
)

# ----------------------------------------------------
# ë°ì´í„° ì§ì ‘ ì •ì˜ (ì¼ë°˜ìŒì‹ì  ìˆ˜)
# ----------------------------------------------------
RESTAURANT_COUNT_DATA = {
    'Rank': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25],
    'District': [
        'ê°•ë‚¨êµ¬', 'ì†¡íŒŒêµ¬', 'ì˜ë“±í¬êµ¬', 'ë§ˆí¬êµ¬', 'ì„œì´ˆêµ¬', 'ì¤‘êµ¬', 'ê°•ì„œêµ¬', 'ë…¸ì›êµ¬', 
        'ì€í‰êµ¬', 'ê´€ì•…êµ¬', 'ì„±ë¶êµ¬', 'ì¢…ë¡œêµ¬', 'ë™ëŒ€ë¬¸êµ¬', 'ê°•ë™êµ¬', 'ê´‘ì§„êµ¬', 'êµ¬ë¡œêµ¬', 
        'ì–‘ì²œêµ¬', 'ì„±ë™êµ¬', 'ë™ì‘êµ¬', 'ìš©ì‚°êµ¬', 'ê¸ˆì²œêµ¬', 'ë„ë´‰êµ¬', 'ì¤‘ë‘êµ¬', 'ê°•ë¶êµ¬', 'ì„œëŒ€ë¬¸êµ¬'
    ],
    'Count': [
        10654, 7610, 6923, 6658, 6550, 6421, 6211, 5888, 
        5618, 5479, 5456, 5223, 5091, 5022, 4960, 4942, 
        4775, 4688, 4670, 4668, 3892, 3694, 3613, 3572, 3473
    ]
}

# ----------------------------------------------------
# ë°ì´í„° ì§ì ‘ ì •ì˜ (ìœ ëª… ìŒì‹ì  ëª©ë¡)
# ----------------------------------------------------
FAMOUS_RESTAURANTS = {
    'ê°•ë‚¨êµ¬': ['ì‚¼ì›ê°€ë“  ë³¸ì (ê°ˆë¹„)', 'ë•€ë•€(ìŒ€êµ­ìˆ˜)', 'ë…¸í‹°ë“œ ì²­ë‹´(ë„ë„›)'],
    'ê°•ë™êµ¬': ['êµ­ë³´ì„±(ì¤‘ì‹)', 'ì²œí˜¸ë™ì—„ë§ˆì†ë§Œë‘(ë§Œë‘)', 'ëŒ€ì„±ì›(ì§œì¥ë©´)'],
    'ê°•ë¶êµ¬': ['4.19 íƒ‘ìŠ¤íƒ ë“œ(ìˆ˜ì œë²„ê±°)', 'ì‚°ì²­ìˆ¯ë¶ˆê°€ë“  ë¯¸ì•„ì (ë¼ì§€ê³ ê¸°)', 'í™”ê³„ì˜¥(ë‹­ê°ˆë¹„)'],
    'ê°•ì„œêµ¬': ['VIPS ë§ˆê³¡ì›ê·¸ë¡œë¸Œì (ë·”í˜)', 'ì§„ì£¼íšŒê´€ ì—¬ì˜ë„ì  (ë§ˆê³¡ì )(ì½©êµ­ìˆ˜)', 'ì• ìŠë¦¬í€¸ì¦ˆ ë§ˆê³¡ì (ë·”í˜)'],
    'ê´€ì•…êµ¬': ['ìˆœëŒ€íƒ€ìš´ (ë¯¼ì†/ì›ì¡° ë“±)(ìˆœëŒ€ë³¶ìŒ)', 'ìƒ¤ë¡œìˆ˜ê¸¸ ì—¬ëŸ¬ ë§›ì§‘', 'ë°±ìˆœëŒ€ íƒ€ìš´'],
    'ê´‘ì§„êµ¬': ['ì†¡ë¦¼ì‹ë‹¹(ë¼ì§€ë¶ˆë°±)', 'ëŠ¥ë™ë©´ì˜¥(ëƒ‰ë©´)', 'ëª…ì„±ê°ˆë¹„(ê°ˆë¹„)'],
    'êµ¬ë¡œêµ¬': ['ê¶ë™ì¹¼êµ­ìˆ˜(ì¹¼êµ­ìˆ˜)', 'êµ¬ë¡œì‹œì¥ ì˜í”„ë¼ì (í¬ì°¨)', 'íƒœì–‘ë³´ìŒˆ'],
    'ê¸ˆì²œêµ¬': ['ì‹œí¥ë™ ë‚¨ë¬¸ì‹œì¥ ë§›ì§‘ ë‹¤ìˆ˜', 'ë…ì‚°ë™ ìš°ì‹œì¥ ë¨¹ê±°ë¦¬', 'ë§ˆë¦¬ì˜¤ ì•„ìš¸ë › ì£¼ë³€ ì‹ë‹¹ê°€'],
    'ë…¸ì›êµ¬': ['ê°•ê°•ìˆ ë˜ ìƒê³„ì (ê°ˆë¹„)', 'ë°±ì‚¬ë§ˆ(ë‹­ë„ë¦¬íƒ•)', 'ì°½ë™ê³¨ë±…ì´'],
    'ë„ë´‰êµ¬': ['ë°©í•™ë™ ìš°ì´ì²œ ë§›ì§‘ ë‹¤ìˆ˜', 'ë„ë´‰ì‚° ì¸ê·¼ ë‘ë¶€/ë¬µë°¥ì§‘', 'ìŒë¬¸ë™ ì˜›ë‚ ëˆê¹ŒìŠ¤'],
    'ë™ëŒ€ë¬¸êµ¬': ['ë´‰í”¼ì–‘ ë³¸ì (ëƒ‰ë©´/ê°ˆë¹„)', 'ê²½ë™ì‹œì¥ ì‹ë‹¹ê°€', 'í›¼ë°€ë¦¬ìˆ˜ì œë¹„(ìˆ˜ì œë¹„)'],
    'ë™ì‘êµ¬': ['ì§„ì£¼ìœ¡íšŒ(ìœ¡íšŒ)', 'íƒœì„±ìˆœëŒ€êµ­(ìˆœëŒ€êµ­)', 'ìƒë„ë™ ê³±ì°½'],
    'ë§ˆí¬êµ¬': ['ì˜¤ë ˆë…¸ë¼ë©˜ ë³¸ì (ë¼ë©˜)', 'í™ëŒ€ê°œë¯¸(ë®ë°¥)', 'ë¶€ì—‰ì´ëˆê¹ŒìŠ¤(ëˆê¹ŒìŠ¤)'],
    'ì„œëŒ€ë¬¸êµ¬': ['ì˜ì²œì‹œì¥ ë–¡ë³¶ì´', 'í™ë³µ(ì¤‘ì‹)', 'ì›ì¡° ë‹­í•œë§ˆë¦¬'],
    'ì„œì´ˆêµ¬': ['ì˜ë™ì„¤ë íƒ•(ì„¤ë íƒ•)', 'ë§ˆë£¨ì‹¬(ì¥ì–´ë®ë°¥)', 'ì§„ëŒ€ê°(ì°¨ëŒì‚¼í•©)'],
    'ì„±ë™êµ¬': ['ì†Œë¬¸ë‚œì„±ìˆ˜ê°ìíƒ• ë³¸ê´€(ê°ìíƒ•)', 'ì„±ìˆ˜ë™ ëšì„¬ê°ˆë¹„', 'ëŒ€ì„±ê°ˆë¹„(ê°ˆë¹„)'],
    'ì„±ë¶êµ¬': ['ì„±ë¶ë™ ëˆ„ë£½ì§€ë°±ìˆ™', 'ë‚˜í´ë ˆì˜¹ ì œê³¼ì (ë¹µ)', 'ë™ë„¤ë°©ë„¤(íŒŒì „)'],
    'ì†¡íŒŒêµ¬': ['ë°©ì´ë™ ë¨¹ìê³¨ëª© ë§›ì§‘ ë‹¤ìˆ˜', 'ë©˜ì•¼í•˜ë‚˜ë¹„ ì ì‹¤ì (ë§ˆì œì†Œë°”)', 'ë°±ì œê³ ë¶„ë¡œ ë¼ì§€ê°ˆë¹„'],
    'ì–‘ì²œêµ¬': ['ì˜¤ëª©êµ ë¯¸ë‹¤ì›€(ìƒ¤ë¸Œìƒ¤ë¸Œ)', 'ëª©ë™ í˜„ëŒ€ë°±í™”ì  í‘¸ë“œì½”íŠ¸', 'ì‹ ì •ë™ ê³°ë‹¬ë˜ê¸¸ ë§›ì§‘'],
    'ì˜ë“±í¬êµ¬': ['ì§„ì£¼ì§‘ ì—¬ì˜ë„(ì¹¼êµ­ìˆ˜/ì½©êµ­ìˆ˜)', 'ë˜ìˆœì´ë„¤ì§‘ ì–‘í‰ë™ì (ëœì¥ì°Œê°œ)', 'ë¬¸ë˜ë™ ì–‘í‚¤í†µë‹­(ì¹˜í‚¨)'],
    'ìš©ì‚°êµ¬': ['ê¿‰ë‹¹(ì‚¼ê²¹ì‚´)', 'ë‹¤ìš´íƒ€ìš°ë„ˆ í•œë‚¨ì (ìˆ˜ì œë²„ê±°)', 'ë°±ê³°ë§‰ê±¸ë¦¬(ë§‰ê±¸ë¦¬/ì•ˆì£¼)'],
    'ì€í‰êµ¬': ['ì—­ì´Œì™•ëˆê¹ŒìŠ¤(ëˆê¹ŒìŠ¤)', 'ì‚°ì±„ì§‘(í•œì •ì‹)', 'ìŠ¤íƒ€ë²…ìŠ¤ ë”ë¶í•œì‚°ì (ì¹´í˜/ë¸ŒëŸ°ì¹˜)'],
    'ì¢…ë¡œêµ¬': ['ëª…ë™êµì(ì¹¼êµ­ìˆ˜)', 'ì‚¼ì²­ë™ìˆ˜ì œë¹„ ë³¸ì (ìˆ˜ì œë¹„)', 'ì¢…ë¡œ3ê°€ í¬ì¥ë§ˆì°¨ ê³¨ëª©'],
    'ì¤‘êµ¬': ['ìš°ë˜ì˜¥ ë³¸ì (ëƒ‰ë©´)', 'ëª…ë™êµì ë³¸ì (ì¹¼êµ­ìˆ˜)', 'ì• ì„±íšŒê´€ í•œìš°ê³°íƒ•(ê³°íƒ•)'],
    'ì¤‘ë‘êµ¬': ['ë¬µë™ ì´ëª¨ë„¤ ì™•íŒŒì „(íŒŒì „)', 'ë§ìš°ë™ í• ë¨¸ë‹ˆ ë¹ˆëŒ€ë–¡', 'ì‚¬ê°€ì • ê³±ì°½']
}


@st.cache_data
def load_count_data():
    """ì •ì˜ëœ ìŒì‹ì  ìˆ˜ ë°ì´í„°ë¥¼ DataFrameìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤."""
    df = pd.DataFrame(RESTAURANT_COUNT_DATA)
    df['Count'] = df['Count'].astype(int)
    return df

# ë°ì´í„° ë¡œë“œ
df_count = load_count_data()

# ----------------------------------------------------
# ì‹œê°í™” í•¨ìˆ˜ (Plotly)
# ----------------------------------------------------
def create_plotly_chart(df):
    """Plotly ë§‰ëŒ€ ê·¸ë˜í”„ ìƒì„± (ê¸°ì¡´ ë¡œì§ ìœ ì§€)"""
    
    fig = px.bar(
        df,
        x='District',          
        y='Count',             
        color='Count',         
        color_continuous_scale=px.colors.sequential.Plasma_r, 
        title="ì„œìš¸ì‹œ ìì¹˜êµ¬ë³„ ì¼ë°˜ìŒì‹ì  ìˆ˜ í˜„í™©",
        labels={
            "District": "ìì¹˜êµ¬",
            "Count": "ì¼ë°˜ìŒì‹ì  ìˆ˜ (ê°œ)",
            "color": "ìŒì‹ì  ìˆ˜"
        },
        height=550,
        hover_data={"Rank": True, "Count": ":,"} 
    )

    top_district = df.iloc[0]['District']
    
    if top_district == 'ê°•ë‚¨êµ¬':
        try:
            colors_list = list(fig.data[0].marker.color)
            if len(colors_list) > 0:
                colors_list[0] = 'red'
            fig.update_traces(marker_color=colors_list, selector=dict(type='bar'))
            
        except AttributeError:
             st.warning("ê²½ê³ : Plotly ê·¸ë˜í”„ì˜ 1ìœ„ ë§‰ëŒ€ ìƒ‰ìƒ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. (ë‚´ë¶€ êµ¬ì¡° ë¬¸ì œ)")

    fig.update_xaxes(title_font=dict(size=14), tickangle=45)
    fig.update_yaxes(title_font=dict(size=14))
    fig.update_traces(hovertemplate='<b>%{x}</b><br>ìŒì‹ì  ìˆ˜: %{y:,}ê°œ<extra></extra>')

    return fig

# ----------------------------------------------------
# Streamlit UI êµ¬ì„±
# ----------------------------------------------------
st.title("ì„œìš¸ì‹œ ìì¹˜êµ¬ë³„ ì¼ë°˜ìŒì‹ì  ìˆ˜ ë° ìœ ëª… ë§›ì§‘ ë¶„ì„ ğŸ—ºï¸")
st.markdown("---")

# 1. ê·¸ë˜í”„ ì¶œë ¥
st.subheader("ğŸ“ˆ ì¼ë°˜ìŒì‹ì  ìˆ˜ ì‹œê°í™” (Plotly Bar Chart)")
if not df_count.empty:
    fig = create_plotly_chart(df_count)
    st.plotly_chart(fig, use_container_width=True)


# 2. ìœ ëª… ë§›ì§‘ ì„ íƒ ê¸°ëŠ¥ ì¶”ê°€
st.markdown("### ğŸ” ìì¹˜êµ¬ë³„ ìœ ëª… ìŒì‹ì  ë³´ê¸°")

# ìì¹˜êµ¬ ëª©ë¡ì„ ì •ë ¬í•˜ì—¬ ì…€ë ‰íŠ¸ ë°•ìŠ¤ì— ì‚¬ìš©
district_list = sorted(df_count['District'].unique().tolist())
selected_district = st.selectbox(
    "ìœ ëª…í•œ ìŒì‹ì ì„ ì•Œê³  ì‹¶ì€ ìì¹˜êµ¬ë¥¼ ì„ íƒí•˜ì„¸ìš”.",
    district_list
)

if selected_district:
    st.markdown(f"#### **{selected_district}**ì˜ ìœ ëª… ìŒì‹ì ")
    
    # FAMOUS_RESTAURANTS ë”•ì…”ë„ˆë¦¬ì—ì„œ í•´ë‹¹ êµ¬ì˜ ìŒì‹ì  ëª©ë¡ì„ ê°€ì ¸ì˜´
    restaurants = FAMOUS_RESTAURANTS.get(selected_district, ["ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."])
    
    # ìŒì‹ì  ëª©ë¡ì„ ìˆœì„œê°€ ìˆëŠ” ë¦¬ìŠ¤íŠ¸ë¡œ ì¶œë ¥
    for i, name in enumerate(restaurants):
        st.write(f"**{i+1}.** {name}")

st.markdown("---")


# 3. ë°ì´í„° í…Œì´ë¸” ì¶œë ¥
st.markdown("### ğŸ“‹ ë°ì´í„° í…Œì´ë¸”") 

if not df_count.empty:
    
    # ê°€ë…ì„± ê°œì„  ìŠ¤íƒ€ì¼ë§
    styled_df = df_count.style.format({
        'Count': '{:,.0f}'.format 
    }).set_properties(
        subset=['Count'], **{'text-align': 'right'} 
    ).set_table_styles([
        {'selector': 'tbody tr:nth-child(odd)', 'props': [('background-color', '#f0f2f6')]}
    ])

    # DataFrame ì¶œë ¥ (ì»¬ëŸ¼ ë„ˆë¹„ ì¡°ì • ì ìš©)
    st.dataframe(
        styled_df, 
        hide_index=True,
        column_config={
            "Rank": st.column_config.Column(width="tiny"), 
            "District": st.column_config.Column(width="medium"),
            "Count": st.column_config.Column(
                "ì¼ë°˜ìŒì‹ì  ìˆ˜ (ê°œ)",
                width="large",
            )
        }
    )
    
    st.caption("â€» ë°ì´í„° ì¶œì²˜: ì„œìš¸ì‹œ ìƒê¶Œë¶„ì„ì„œë¹„ìŠ¤ ê¸°ë°˜ 2024ë…„ 6ì›” í˜„í™© ë° ëŒ€ì¤‘ì  ì¸ì§€ë„ ê¸°ë°˜")
